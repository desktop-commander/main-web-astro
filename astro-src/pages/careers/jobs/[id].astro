---
import Layout from '../../../layouts/Layout.astro';
import NavigationAstro from '../../../../src/components/NavigationAstro';
import Footer from '../../../../src/components/Footer';
import jobsData from '../../../../src/data/jobs.json';

// Generate static paths for all jobs
export async function getStaticPaths() {
  return jobsData.jobs.map(job => ({
    params: { id: job.id },
    props: { job }
  }));
}

// Get the job ID and job data from Astro
const { id } = Astro.params;
const { job } = Astro.props;

// If no job found, redirect to careers page
if (!job) {
  return Astro.redirect('/careers', 302);
}

const formatDate = (dateString: string) => {
  const date = new Date(dateString);
  return date.toLocaleDateString('en-US', { 
    year: 'numeric', 
    month: 'long', 
    day: 'numeric' 
  });
};
---

<Layout 
  title={`${job.title} - Desktop Commander`}
  description={job.description}
>
  <div class="min-h-screen bg-background">
    <NavigationAstro client:load />
    <div class="pt-20">
      
      <!-- Hero Section with Gradient Background -->
      <div class="relative bg-gradient-to-br from-primary/5 via-background to-background border-b">
        <div class="container mx-auto px-4 py-12 max-w-4xl">
          <!-- Back Button -->
          <a 
            href="/careers"
            class="inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring hover:bg-accent hover:text-accent-foreground mb-6 -ml-2 text-muted-foreground h-10 px-4 py-2"
          >
            <svg class="h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
            </svg>
            Back to Careers
          </a>

          <!-- Header -->
          <div>
            <h1 class="text-3xl md:text-4xl lg:text-5xl font-bold mb-4">{job.title}</h1>
            
            <div class="flex flex-wrap gap-3 mb-6">
              <span class="inline-flex items-center gap-1.5 rounded-md border px-3 py-1 text-xs font-semibold transition-colors border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80">
                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <rect width="20" height="14" x="2" y="7" rx="2" ry="2"></rect>
                  <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path>
                </svg>
                {job.department}
              </span>
              <span class="inline-flex items-center gap-1.5 rounded-md border px-3 py-1 text-xs font-semibold transition-colors border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80">
                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"></path>
                  <circle cx="12" cy="10" r="3"></circle>
                </svg>
                {job.location}
              </span>
              <span class="inline-flex items-center gap-1.5 rounded-md border px-3 py-1 text-xs font-semibold transition-colors border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80">
                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <circle cx="12" cy="12" r="10"></circle>
                  <polyline points="12 6 12 12 16 14"></polyline>
                </svg>
                {job.type}
              </span>
              <span class="inline-flex items-center gap-1.5 rounded-md border px-3 py-1 text-xs font-semibold transition-colors border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80">
                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <rect width="18" height="18" x="3" y="4" rx="2" ry="2"></rect>
                  <line x1="16" x2="16" y1="2" y2="6"></line>
                  <line x1="8" x2="8" y1="2" y2="6"></line>
                  <line x1="3" x2="21" y1="10" y2="10"></line>
                </svg>
                Posted {formatDate(job.postedDate)}
              </span>
            </div>

            <!-- Apply Button in Hero -->
            <a
              href={job.applyUrl}
              target="_blank"
              rel="noopener noreferrer"
              class="inline-flex items-center justify-center gap-2 rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring dc-button-primary h-11 px-8"
            >
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <rect width="20" height="16" x="2" y="4" rx="2"></rect>
                <path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"></path>
              </svg>
              <span>Apply for this Position</span>
            </a>
          </div>
        </div>
      </div>

      <!-- Main Content -->
      <div class="container mx-auto px-4 py-12 max-w-4xl">
        <div class="space-y-10">
          <!-- Description -->
          <article>
            <h2 class="text-2xl font-semibold mb-4">About the Role</h2>
            <div class="text-muted-foreground space-y-4 text-base leading-relaxed">
              {job.description.split('\n\n').map((paragraph) => (
                <p>{paragraph}</p>
              ))}
            </div>
          </article>

          <hr class="border-border" />

          <!-- Responsibilities -->
          <section>
            <h2 class="text-2xl font-semibold mb-4">What you'll do:</h2>
            <ul class="space-y-3">
              {job.responsibilities.map((responsibility) => (
                <li class="flex items-start gap-3">
                  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-primary flex-shrink-0 mt-0.5">
                    <polyline points="20 6 9 17 4 12"></polyline>
                  </svg>
                  <span class="text-muted-foreground leading-relaxed">{responsibility}</span>
                </li>
              ))}
            </ul>
          </section>

          <hr class="border-border" />

          <!-- Requirements -->
          <section>
            <h2 class="text-2xl font-semibold mb-4">What we're looking for:</h2>
            <ul class="space-y-3">
              {job.requirements.map((requirement) => (
                <li class="flex items-start gap-3">
                  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-primary flex-shrink-0 mt-0.5">
                    <polyline points="20 6 9 17 4 12"></polyline>
                  </svg>
                  <span class="text-muted-foreground leading-relaxed">{requirement}</span>
                </li>
              ))}
            </ul>
          </section>

 font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring dc-button-primary h-11 px-8 mx-auto"
              >
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <rect width="20" height="16" x="2" y="4" rx="2"></rect>
                  <path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"></path>
                </svg>
                <span>Apply Now</span>
              </a>
            </div>
          </div>
        </div>
      </div>

    </div>
    <Footer client:visible />
  </div>
</Layout>

<style is:global>
  @import '../../../../src/index.css';
</style>
